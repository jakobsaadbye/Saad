//////////////////////////////////
// Runtime package
//
// @Note: This MUST match the datastructures laid out in runtime_support.c
//////////////////////////////////

String :: struct {
    data: *char;
    len:   s64;
}

TypeKind :: enum {
    Void,
    Bool, 
    Int,
    Float,
    String,
    Array,
    Pointer,
    Struct,
    Enum,
    Function,
    Tuple,
    Variadic,
    Any,
};

TypePrimitiveKind :: enum {
    Uint, // alias for u32
    U8,
    U16,
    U32,
    U64,
    Int, // alias for s32
    S8,
    S16,
    S32,
    S64,
    Float, // alias for f32
    F32,
    F64,
    String,
    Bool,
    Void,
    UntypedInt,
    UntypedFloat,
};

TypeArrayKind :: enum {
    Fixed,
    Slice,
    Dynamic,
}

Type :: struct {
    kind:  TypeKind;
    name:  string;
    size:  int;
    flags: int;
};

TypePrimitive :: struct  {
    head: Type;
    kind: TypePrimitiveKind;
};

TypePointer :: struct {
    head:       Type;
    pointerTo: *Type;
}

TypeArray :: struct {
    head:      Type;
    kind:      TypeArrayKind;
    elemType: *Type;
    count:     int;
}

TypeEnum :: struct {
    head:         Type;
    valueName:    string;
    backingType: *Type;
    minValue:     int;
    maxValue:     int;
};

StructMember :: struct {
    name:  string;
    type:  *Type;
    value: *void;
    index:  int;
    offset: int;
}

TypeStruct :: struct {
    head:      Type;
    members:   []StructMember;
    alignment: int;
};

TypeAny :: struct {
    head:  Type;
    data: *void;
    type: *Type;
}

//////////////////////////////////
// Raw underlying types
//////////////////////////////////

Any :: struct {
    data: *void;
    type: *Type;
}

RawDynamicArray :: struct {
    data:     *u8;
    count:    s64;
    cap:      s64;
    elemSize: s64;
}

extern "C" {
    runtime_get_type_pointer :: (name: string, pointerTo: *Type) -> *TypePointer;
    runtime_get_type_array   :: (name: string, kind: TypeArrayKind, elem_type: *Type, count: int) -> *TypeArray;
    runtime_get_type_enum    :: (name: string, valueName: string, backingType: *Type, minValue: int, maxValue: int) -> *TypeEnum;
    runtime_get_type_struct  :: (name: string, members: *StructMember, members_count: int, size: int, alignment: int) -> *TypeStruct;
    runtime_get_type_any     :: () -> *TypeAny;
    runtime_builtin_append   :: (arr: RawDynamicArray, elem: *void) -> void;
    runtime_compare_strings  :: (str1: *string, str2: *string) -> int;
}

isPrimitive :: method (type: *Type) -> bool {
    if type.kind == .Bool { return true; } 
    if type.kind == .Int { return true; }
    if type.kind == .Float { return true; }
    if type.kind == .String { return true; }
    return false;
}