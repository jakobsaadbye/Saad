import "c_string"; // strlen, @Remove: Once we have better strings
import "strings";
import "arrays";

PLACEHOLDER_CHARACTER :: 37;  // '%'

extern "C" {
    sprintf :: (buffer: *u8, format: string, args: ...any) -> int;
    printf  :: (format: string, args: ...any) -> int;
}

Print :: (format: string, args: ...any) {

    // Scan the format string to find all the placeholders
    placeholderIndicies: [..]int;
    for i in 0..strlen(format) {
        c := (cast(*u8)format)[i];

        if c == PLACEHOLDER_CHARACTER {
            appendInt(&placeholderIndicies, i);
        }
    }

    // Build up the result string by pasting each segment of the source string
    sb := NewStringBuilder(1024);

    cursor := 0;
    for index, i in placeholderIndicies {

        // Add the static text up untill the placeholder
        sb.addStringSlice(format, cursor, index);

        // Fill in the placeholder
        arg := args[i];
        sb.addAnyValue(arg);

        cursor = index + 1;
    }

    // Append the trailing part after the last placeholder
    sb.addStringSlice(format, cursor, strlen(format));

    result := sb.toString();
    
    printf("%s", result);
    
    sb.free();
    return;
}

